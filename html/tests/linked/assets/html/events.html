
<section id=events>
    <h2>Events</h2>

    <p>Various CodeMirror-related objects emit events, which allow
    client code to react to various situations. Handlers for such
    events can be registered with the <a href="#on"><code>on</code></a>
    and <a href="#off"><code>off</code></a> methods on the objects
    that the event fires on. To fire your own events,
    use <code>CodeMirror.signal(target, name, args...)</code>,
    where <code>target</code> is a non-DOM-node object.</p>

    <p>An editor instance fires the following events.
    The <code>instance</code> argument always refers to the editor
    itself.</p>

    <dl>
      <dt id="event_change"><code><strong>"change"</strong> (instance: CodeMirror, changeObj: object)</code></dt>
      <dd>Fires every time the content of the editor is changed.
      The <code>changeObj</code> is a <code>{from, to, text, removed,
      origin}</code> object containing information about the changes
      that occurred as second argument. <code>from</code>
      and <code>to</code> are the positions (in the pre-change
      coordinate system) where the change started and ended (for
      example, it might be <code>{ch:0, line:18}</code> if the
      position is at the beginning of line #19). <code>text</code> is
      an array of strings representing the text that replaced the
      changed range (split by line). <code>removed</code> is the text
      that used to be between <code>from</code> and <code>to</code>,
      which is overwritten by this change. This event is
      fired <em>before</em> the end of
      an <a href="#operation">operation</a>, before the DOM updates
      happen.</dd>

      <dt id="event_changes"><code><strong>"changes"</strong> (instance: CodeMirror, changes: array&lt;object&gt;)</code></dt>
      <dd>Like the <a href="#event_change"><code>"change"</code></a>
      event, but batched per <a href="#operation">operation</a>,
      passing an array containing all the changes that happened in the
      operation. This event is fired after the operation finished, and
      display changes it makes will trigger a new operation.</dd>

      <dt id="event_beforeChange"><code><strong>"beforeChange"</strong> (instance: CodeMirror, changeObj: object)</code></dt>
      <dd>This event is fired before a change is applied, and its
      handler may choose to modify or cancel the change.
      The <code>changeObj</code> object
      has <code>from</code>, <code>to</code>, and <code>text</code>
      properties, as with
      the <a href="#event_change"><code>"change"</code></a> event. It
      also has a <code>cancel()</code> method, which can be called to
      cancel the change, and, <strong>if</strong> the change isn't
      coming from an undo or redo event, an <code>update(from, to,
      text)</code> method, which may be used to modify the change.
      Undo or redo changes can't be modified, because they hold some
      metainformation for restoring old marked ranges that is only
      valid for that specific change. All three arguments
      to <code>update</code> are optional, and can be left off to
      leave the existing value for that field
      intact. <strong>Note:</strong> you may not do anything from
      a <code>"beforeChange"</code> handler that would cause changes
      to the document or its visualization. Doing so will, since this
      handler is called directly from the bowels of the CodeMirror
      implementation, probably cause the editor to become
      corrupted.</dd>

      <dt id="event_cursorActivity"><code><strong>"cursorActivity"</strong> (instance: CodeMirror)</code></dt>
      <dd>Will be fired when the cursor or selection moves, or any
      change is made to the editor content.</dd>

      <dt id="event_keyHandled"><code><strong>"keyHandled"</strong> (instance: CodeMirror, name: string, event: Event)</code></dt>
      <dd>Fired after a key is handled through a
      key map. <code>name</code> is the name of the handled key (for
      example <code>"Ctrl-X"</code> or <code>"'q'"</code>),
      and <code>event</code> is the DOM <code>keydown</code>
      or <code>keypress</code> event.</dd>

      <dt id="event_inputRead"><code><strong>"inputRead"</strong> (instance: CodeMirror, changeObj: object)</code></dt>
      <dd>Fired whenever new input is read from the hidden textarea
      (typed or pasted by the user).</dd>

      <dt id="event_electricInput"><code><strong>"electricInput"</strong> (instance: CodeMirror, line: integer)</code></dt>
      <dd>Fired if text input matched the
      mode's <a href="#option_electricChars">electric</a> patterns,
      and this caused the line's indentation to change.</dd>

      <dt id="event_beforeSelectionChange"><code><strong>"beforeSelectionChange"</strong> (instance: CodeMirror, obj: {ranges, origin, update})</code></dt>
      <dd>This event is fired before the selection is moved. Its
      handler may inspect the set of selection ranges, present as an
      array of <code>{anchor, head}</code> objects in
      the <code>ranges</code> property of the <code>obj</code>
      argument, and optionally change them by calling
      the <code>update</code> method on this object, passing an array
      of ranges in the same format. The object also contains
      an <code>origin</code> property holding the origin string passed
      to the selection-changing method, if any. Handlers for this
      event have the same restriction
      as <a href="#event_beforeChange"><code>"beforeChange"</code></a>
      handlers â€” they should not do anything to directly update the
      state of the editor.</dd>

      <dt id="event_viewportChange"><code><strong>"viewportChange"</strong> (instance: CodeMirror, from: number, to: number)</code></dt>
      <dd>Fires whenever the <a href="#getViewport">view port</a> of
      the editor changes (due to scrolling, editing, or any other
      factor). The <code>from</code> and <code>to</code> arguments
      give the new start and end of the viewport.</dd>

      <dt id="event_swapDoc"><code><strong>"swapDoc"</strong> (instance: CodeMirror, oldDoc: Doc)</code></dt>
      <dd>This is signalled when the editor's document is replaced
      using the <a href="#swapDoc"><code>swapDoc</code></a>
      method.</dd>

      <dt id="event_gutterClick"><code><strong>"gutterClick"</strong> (instance: CodeMirror, line: integer, gutter: string, clickEvent: Event)</code></dt>
      <dd>Fires when the editor gutter (the line-number area) is
      clicked. Will pass the editor instance as first argument, the
      (zero-based) number of the line that was clicked as second
      argument, the CSS class of the gutter that was clicked as third
      argument, and the raw <code>mousedown</code> event object as
      fourth argument.</dd>

      <dt id="event_gutterContextMenu"><code><strong>"gutterContextMenu"</strong> (instance: CodeMirror, line: integer, gutter: string, contextMenu: Event: Event)</code></dt>
      <dd>Fires when the editor gutter (the line-number area)
      receives a <code>contextmenu</code> event. Will pass the editor
      instance as first argument, the (zero-based) number of the line
      that was clicked as second argument, the CSS class of the
      gutter that was clicked as third argument, and the raw
      <code>contextmenu</code> mouse event object as fourth argument.
      You can <code>preventDefault</code> the event, to signal that
      CodeMirror should do no further handling.</dd>

      <dt id="event_focus"><code><strong>"focus"</strong> (instance: CodeMirror, event: Event)</code></dt>
      <dd>Fires whenever the editor is focused.</dd>

      <dt id="event_blur"><code><strong>"blur"</strong> (instance: CodeMirror, event: Event)</code></dt>
      <dd>Fires whenever the editor is unfocused.</dd>

      <dt id="event_scroll"><code><strong>"scroll"</strong> (instance: CodeMirror)</code></dt>
      <dd>Fires when the editor is scrolled.</dd>

      <dt id="event_refresh"><code><strong>"refresh"</strong> (instance: CodeMirror)</code></dt>
      <dd>Fires when the editor is <a href="#refresh">refreshed</a>
      or <a href="#setSize">resized</a>. Mostly useful to invalidate
      cached values that depend on the editor or character size.</dd>

      <dt id="event_optionChange"><code><strong>"optionChange"</strong> (instance: CodeMirror, option: string)</code></dt>
      <dd>Dispatched every time an option is changed with <a href="#setOption"><code>setOption</code></a>.</dd>

      <dt id="event_scrollCursorIntoView"><code><strong>"scrollCursorIntoView"</strong> (instance: CodeMirror, event: Event)</code></dt>
      <dd>Fires when the editor tries to scroll its cursor into view.
      Can be hooked into to take care of additional scrollable
      containers around the editor. When the event object has
      its <code>preventDefault</code> method called, CodeMirror will
      not itself try to scroll the window.</dd>

      <dt id="event_update"><code><strong>"update"</strong> (instance: CodeMirror)</code></dt>
      <dd>Will be fired whenever CodeMirror updates its DOM display.</dd>

      <dt id="event_renderLine"><code><strong>"renderLine"</strong> (instance: CodeMirror, line: LineHandle, element: Element)</code></dt>
      <dd>Fired whenever a line is (re-)rendered to the DOM. Fired
      right after the DOM element is built, <em>before</em> it is
      added to the document. The handler may mess with the style of
      the resulting element, or add event handlers, but
      should <em>not</em> try to change the state of the editor.</dd>

      <dt id="event_dom"><code><strong>"mousedown"</strong>,
      <strong>"dblclick"</strong>, <strong>"touchstart"</strong>, <strong>"contextmenu"</strong>,
      <strong>"keydown"</strong>, <strong>"keypress"</strong>,
      <strong>"keyup"</strong>, <strong>"cut"</strong>, <strong>"copy"</strong>, <strong>"paste"</strong>,
      <strong>"dragstart"</strong>, <strong>"dragenter"</strong>,
      <strong>"dragover"</strong>, <strong>"dragleave"</strong>,
      <strong>"drop"</strong>
      (instance: CodeMirror, event: Event)</code></dt>
      <dd>Fired when CodeMirror is handling a DOM event of this type.
      You can <code>preventDefault</code> the event, or give it a
      truthy <code>codemirrorIgnore</code> property, to signal that
      CodeMirror should do no further handling.</dd>
    </dl>

    <p>Document objects (instances
    of <a href="#Doc"><code>CodeMirror.Doc</code></a>) emit the
    following events:</p>

    <dl>
      <dt id="event_doc_change"><code><strong>"change"</strong> (doc: CodeMirror.Doc, changeObj: object)</code></dt>
      <dd>Fired whenever a change occurs to the
      document. <code>changeObj</code> has a similar type as the
      object passed to the
      editor's <a href="#event_change"><code>"change"</code></a>
      event.</dd>

      <dt id="event_doc_beforeChange"><code><strong>"beforeChange"</strong> (doc: CodeMirror.Doc, change: object)</code></dt>
      <dd>See the <a href="#event_beforeChange">description of the
      same event</a> on editor instances.</dd>

      <dt id="event_doc_cursorActivity"><code><strong>"cursorActivity"</strong> (doc: CodeMirror.Doc)</code></dt>
      <dd>Fired whenever the cursor or selection in this document
      changes.</dd>

      <dt id="event_doc_beforeSelectionChange"><code><strong>"beforeSelectionChange"</strong> (doc: CodeMirror.Doc, selection: {head, anchor})</code></dt>
      <dd>Equivalent to
      the <a href="#event_beforeSelectionChange">event by the same
      name</a> as fired on editor instances.</dd>
    </dl>

    <p>Line handles (as returned by, for
    example, <a href="#getLineHandle"><code>getLineHandle</code></a>)
    support these events:</p>

    <dl>
      <dt id="event_delete"><code><strong>"delete"</strong> ()</code></dt>
      <dd>Will be fired when the line object is deleted. A line object
      is associated with the <em>start</em> of the line. Mostly useful
      when you need to find out when your <a href="#setGutterMarker">gutter
      markers</a> on a given line are removed.</dd>
      <dt id="event_line_change"><code><strong>"change"</strong> (line: LineHandle, changeObj: object)</code></dt>
      <dd>Fires when the line's text content is changed in any way
      (but the line is not deleted outright). The <code>change</code>
      object is similar to the one passed
      to <a href="#event_change">change event</a> on the editor
      object.</dd>
    </dl>

    <p>Marked range handles (<code>CodeMirror.TextMarker</code>), as returned
    by <a href="#markText"><code>markText</code></a>
    and <a href="#setBookmark"><code>setBookmark</code></a>, emit the
    following events:</p>

    <dl>
      <dt id="event_beforeCursorEnter"><code><strong>"beforeCursorEnter"</strong> ()</code></dt>
      <dd>Fired when the cursor enters the marked range. From this
      event handler, the editor state may be inspected
      but <em>not</em> modified, with the exception that the range on
      which the event fires may be cleared.</dd>
      <dt id="event_clear"><code><strong>"clear"</strong> (from: {line, ch}, to: {line, ch})</code></dt>
      <dd>Fired when the range is cleared, either through cursor
      movement in combination
      with <a href="#mark_clearOnEnter"><code>clearOnEnter</code></a>
      or through a call to its <code>clear()</code> method. Will only
      be fired once per handle. Note that deleting the range through
      text editing does not fire this event, because an undo action
      might bring the range back into existence. <code>from</code>
      and <code>to</code> give the part of the document that the range
      spanned when it was cleared.</dd>
      <dt id="event_hide"><code><strong>"hide"</strong> ()</code></dt>
      <dd>Fired when the last part of the marker is removed from the
      document by editing operations.</dd>
      <dt id="event_unhide"><code><strong>"unhide"</strong> ()</code></dt>
      <dd>Fired when, after the marker was removed by editing, a undo
      operation brought the marker back.</dd>
    </dl>

    <p>Line widgets (<code>CodeMirror.LineWidget</code>), returned
    by <a href="#addLineWidget"><code>addLineWidget</code></a>, fire
    these events:</p>

    <dl>
      <dt id="event_redraw"><code><strong>"redraw"</strong> ()</code></dt>
      <dd>Fired whenever the editor re-adds the widget to the DOM.
      This will happen once right after the widget is added (if it is
      scrolled into view), and then again whenever it is scrolled out
      of view and back in again, or when changes to the editor options
      or the line the widget is on require the widget to be
      redrawn.</dd>
    </dl>
</section>